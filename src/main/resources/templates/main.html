<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset=utf-8>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메인 페이지</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.css"/>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <link rel="stylesheet" type="text/css" href="css/pluton.css"/>
    <link rel="stylesheet" type="text/css" href="css/pluton-ie7.css"/>
    <link rel="stylesheet" type="text/css" href="css/jquery.cslider.css"/>
    <link rel="stylesheet" type="text/css" href="css/jquery.bxslider.css"/>
    <link rel="stylesheet" type="text/css" href="css/animate.css"/>
    <link rel="icon" href="/assets/img/logo.png" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/img/logo.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>

        /* 기본 이미지 스타일 */
        .da-img img {
            width: 300px; /* 기본 너비 설정 */
            height: auto; /* 높이는 비율에 맞게 자동 조절 */
            border-radius: 15px; /* 테두리 둥글게 처리 */
        }

        /* 화면 너비가 767px 이하일 때 적용될 스타일 */
        @media (max-width: 767px) {
            .da-img img {
                width: 100%; /* 이미지 너비를 부모 요소에 맞춤 */
                height: auto; /* 높이는 자동으로 설정 */
            }
        }

        .thumbnail {
            border: 2px solid #191a1c;
        }

        .thumbnail h3 {
            margin: 5px 0;
            word-wrap: break-word;
            max-height: 4.4em;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.5;
        }

        .profile-menu:hover .profile-sub-menu {
            display: block;
        }

        .chart-container {
            width: 45%; /* 각 차트의 너비를 45%로 설정 */
            height: 300px; /* 높이 설정 */
            margin: auto; /* 가운데 정렬 */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chart-wrapper {
            display: flex; /* Flexbox 사용 */
            justify-content: space-around; /* 공간을 균등하게 분배 */
        }

        .chart-description {
            text-align: center;
            margin-top: 10px; /* 그래프와 설명 사이의 간격 조정 */
        }

        #div1 {
            background-image: url("/assets/img/1.jpg");
            background-size: cover; /* 배경 이미지를 화면 전체에 맞춥니다. */
            background-repeat: no-repeat; /* 배경 이미지 반복 제거 */
        }

        #div2 {
            background-image: url("/assets/img/2.jpg");
            background-size: cover; /* 배경 이미지를 화면 전체에 맞춥니다. */
            background-repeat: no-repeat; /* 배경 이미지 반복 제거 */
        }

        #div3 {
            background-image: url("/assets/img/3.jpg");
            background-size: cover; /* 배경 이미지를 화면 전체에 맞춥니다. */
            background-repeat: no-repeat; /* 배경 이미지 반복 제거 */
        }

        .da-slide h4 {
            white-space: normal; /* 긴 제목의 자동 줄바꿈을 허용 */
            word-wrap: break-word; /* 긴 단어도 줄바꿈 */
            max-width: 400px; /* 최대 너비 설정 */
            margin-bottom: 10px;
        }

        .da-img img {
            border-radius: 20px; /* 이미지 테두리를 둥글게 */
        }

        .da-slide p {
            margin-top: 0; /* 상단 마진 제거 */
            padding-top: 15px; /* 상단 패딩 추가 */
        }
    </style>
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener("DOMContentLoaded", function () {
            // 임의의 데이터 사용
            const topDistricts = /*[[${topDistricts}]]*/ {};
            const eventTypeCount = /*[[${eventTypeCount}]]*/ {};

            const parsedTopDistricts = JSON.parse(topDistricts);
            const labels = Object.keys(parsedTopDistricts);
            const data = Object.values(parsedTopDistricts);

            const ctx = document.getElementById('eventChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '문화행사 수',
                        data: data,
                        backgroundColor: 'rgba(0, 255, 255, 0.6)', // 시안색 네온
                        borderColor: 'rgba(0, 255, 255, 1)', // 시안색 네온
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            ticks: {
                                color: '#3b5260'  // y축 텍스트 색상
                            },
                            title: {
                                display: true,
                                color: '#3b5260'  // y축 제목 색상
                            }
                        },
                        x: {
                            ticks: {
                                color: '#3b5260'  // x축 텍스트 색상
                            },
                            title: {
                                display: true,
                                color: '#3b5260'  // x축 제목 색상
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#3b5260'  // 범례 텍스트 색상
                            }
                        }
                    }
                }
            });

            const parsedEventTypeCount = JSON.parse(eventTypeCount);
            const eventTypeLabels = Object.keys(parsedEventTypeCount);
            const eventTypeData = Object.values(parsedEventTypeCount);

            const ctx2 = document.getElementById('eventTypeChart').getContext('2d');
            new Chart(ctx2, {
                type: 'pie',
                data: {
                    labels: eventTypeLabels,
                    datasets: [{
                        label: '문화행사 유형',
                        data: eventTypeData,
                        backgroundColor: [
                            'rgba(255, 0, 255, 0.4)', // 핑크 네온
                            'rgba(0, 255, 0, 0.4)',   // 녹색 네온
                            'rgba(0, 255, 255, 0.4)', // 시안 네온
                            'rgba(255, 165, 0, 0.4)', // 주황 네온
                            'rgba(255, 0, 0, 0.4)',   // 레드 네온
                            'rgba(0, 0, 255, 0.4)'    // 블루 네온
                        ],
                        borderColor: [
                            'rgba(255, 0, 255, 1)',
                            'rgba(0, 255, 0, 1)',
                            'rgba(0, 255, 255, 1)',
                            'rgba(255, 165, 0, 1)',
                            'rgba(255, 0, 0, 1)',
                            'rgba(0, 0, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#3b5260'  // 범례 텍스트 색상
                            }
                        }
                    }
                }
            });
        });

        const userId = /*[[${dto.userId}]]*/ '';

        document.addEventListener('DOMContentLoaded', function () {

            if (userId === null || userId === '' || userId === 'null') {
                alert("로그인 하시길 바랍니다.");
                window.location.href = '/user/login';
            }

        });

        function goToUserProfile() {
            window.location.href = "/user/userProfile/" + userId;
        }

        /*]]>*/
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            const today = new Date();
            const options = {year: 'numeric', month: '2-digit', day: '2-digit', weekday: 'short'};
            const formattedDate = today.toLocaleDateString('ko-KR', options)
                .replace(/(\d+)\.(\d+)\.(\d+)\.\s(\(\w+\))/, '$1.$2.$3$4')
                .replace(/\s/g, '')
                .replace(/(\d{4}\.\d{2}\.\d{2})\./, '$1');

            // 모든 슬라이드에 날짜 삽입
            document.querySelectorAll('.da-slide h2').forEach(function (h2) {
                const dateH2 = document.createElement('h2');
                dateH2.style.cssText = "font-size: 20px; color: #3b5260; position: relative; top: 150px;";
                dateH2.textContent = formattedDate;
                h2.parentNode.insertBefore(dateH2, h2.nextSibling); // h2 다음에 날짜 삽입
            });

            const links = document.querySelectorAll('.da-link');
            links.forEach(link => {
                const img = link.closest('.da-slide').querySelector('.da-img img');
                if (img) {
                    const imgSrc = img.getAttribute('src');
                    const fileId = imgSrc.split('atchFileId=')[1].split('&')[0];  // 파일 ID 추출
                    link.href = `/event/apiInfo?nSeq=${fileId}`;  // 추출된 파일 ID를 링크에 적용
                }
            });
        });
    </script>
</head>
<body>
<div class="navbar">
    <div class="navbar-inner">
        <div class="container">

            <a href="/main" class="brand">
                <img src="/assets/img/logo3.png" width="170" height="41" alt="Logo">
            </a>

            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <img src="/assets/img/logo5.png" width="30" height="30" alt="Logo">
            </button>

            <div class="nav-collapse collapse pull-right">
                <ul class="nav" id="top-navigation">
                    <li><a style="border: 1px solid #15c6e5;" href="/main">메인 페이지</a></li>
                    <li><a href="/event/apiSearch">문화행사 찾기</a></li>
                    <li><a href="/culture/cultureMap">문화시설 찾기</a></li>
                    <li><a href="/notice/noticeListUsingNativeQuery">커뮤니티</a></li>
                    <li class="dropdown">
                        <a href="" class="dropdown-toggle" data-toggle="dropdown"
                           style="background-color:#5395a9;"><span class="username-color">[[${dto.userName}]]</span>님
                            어서오세요!<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="#" onclick="goToUserProfile()">마이페이지</a></li>
                            <li><a href="/logout" id="logoutLink">로그아웃</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div id="home">
    <div id="da-slider" class="da-slider">
        <div class="triangle"></div>
        <div class="mask"></div>
        <div class="container">

            <div th:each="item : ${rList}" class="da-slide">
                <h2 style="color: #3b5260">오늘의 추천 문화행사</h2>
                <h4 style="font-size: 20px; color: #5d8198; font-weight: normal; top:220px">
                    <strong style="color: #3b5260">행사제목 :</strong> <span th:text="${item.title}">행사제목</span>
                </h4>
                <h4 style="font-size: 20px; color: #5d8198; font-weight: normal; top:280px">
                    <strong style="color: #3b5260">장소 :</strong> <span th:text="${item.place}">장소</span>
                </h4>
                <a href="#" class="da-link button">상세보기</a>
                <div class="da-img">
                    <img style="max-height: 350px; width: auto" src="" th:src="${item.mainImg}" alt="문화행사 이미지">
                </div>
            </div>

            <div class="da-arrows">
                <span class="da-arrows-prev"></span>
                <span class="da-arrows-next"></span>
            </div>

        </div>
    </div>
</div>

<div class="section primary-section" id="service">
    <div class="container">
        <div class="title" style="margin-top: -30px">
            <h4>당신의 문화생활을 한 단계 업그레이드하는 문화행사 및 문화공간 안내 서비스</h4>

            <p>서울문화마당에 오신걸 환영합니다!</p>
        </div>

        <div class="row-fluid">
            <div class="container" style="margin-top: -40px">
                <div class="feature-grid">
                    <div class="feature" id="div1" onclick="location.href='/event/apiSearch';"
                         style="position: relative; overflow: hidden; transition: transform 0.3s ease; cursor: pointer;">
                        <!--                        <img class="icon" src="/assets/img/icon1.png" style="position: absolute; width: 14%" alt="">-->
                        <h2 style="font-size: 22px; text-align: center; padding-top: 40px;">
                            <span style="color: #ffffff; background-color: #5d8198;">문화행사 찾기</span>
                        </h2>
                        <!--                        <p style="text-align: center; transition: transform 0.3s ease; color: #3b5260; background-color: #b3ecec;">관심있는 문화행사의 정보를 확인할 수 있습니다.</p>-->
                        <br><br>
                    </div>
                    <div class="feature" id="div2" onclick="location.href='/culture/cultureMap';"
                         style="position: relative; overflow: hidden; transition: transform 0.3s ease; cursor: pointer;">
                        <!--                        <img class="icon" src="/assets/img/icon2.png" style="position: absolute; width: 14%" alt="">-->
                        <h2 style="font-size: 22px; text-align: center; padding-top: 40px; transition: transform 0.3s ease;">
                            <span style="color: #ffffff; background-color: #5d8198;">문화시설 찾기</span>
                        </h2>
                        <!--                        <p style="text-align: center; transition: transform 0.3s ease; color: #3b5260; background-color: #b3ecec;">근처의 문화시설 정보를 확인할 수 있습니다.</p>-->
                    </div>
                    <div class="feature" id="div3" onclick="location.href='/notice/noticeListUsingNativeQuery';"
                         style="position: relative; overflow: hidden; transition: transform 0.3s ease; cursor: pointer;">
                        <!--                        <img class="icon" src="/assets/img/icon3.png" style="position: absolute; width: 14%" alt="">-->
                        <h2 style="font-size: 22px; text-align: center; padding-top: 40px; transition: transform 0.3s ease;">
                            <span style="color: #ffffff; background-color: #5d8198;">커뮤니티</span></h2>
                        <!--                        <p style="text-align: center; transition: transform 0.3s ease; color: #3b5260; background-color: #b3ecec;">내 경험을 다른 사람들과 공유할 수 있습니다.</p>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="section secondary-section " id="portfolio">
    <div class="triangle2"></div>
    <div class="container">
        <div class="title" style="margin-top: -40px">
            <h3>이달의 문화행사 정보</h3>
        </div>
        <div class="chart-wrapper" style="margin-bottom: 40px">
            <div class="chart-container">
                <p class="chart-description" th:text="${currentMonth} + '월의 문화행사 개최 수'"></p>
                <canvas id="eventChart"></canvas>
            </div>
            <div class="chart-container">
                <p class="chart-description" th:text="${currentMonth} + '월의 문화행사 유형'"></p>
                <canvas id="eventTypeChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="section secondary-section " id="about" style="background-color: #5d8198">
    <div class="triangle"></div>
    <div class="container" style="margin-top: -20px">
        <div class="title">
            <h3>추천 영상</h3>
        </div>
        <div id="single-project">
            <ul id="portfolio-grid" class="thumbnails row">
            </ul>
        </div>
    </div>
</div>
<script src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.mixitup.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/modernizr.custom.js"></script>
<script type="text/javascript" src="js/jquery.bxslider.js"></script>
<script type="text/javascript" src="js/jquery.cslider.js"></script>
<script type="text/javascript" src="js/jquery.placeholder.js"></script>
<script type="text/javascript" src="js/jquery.inview.js"></script>
<script src="js/respond.min.js"></script>
<script type="text/javascript" src="js/app.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const defaultA = document.querySelector('.nav-pills .filter:first-child a');
        defaultA.style.backgroundColor = '#2b2b36';
        defaultA.style.color = 'white';

        const links = document.querySelectorAll('.nav-pills .filter a');
        links.forEach(function (link) {
            link.addEventListener('click', function (event) {
                links.forEach(function (l) {
                    l.style.backgroundColor = '';
                    l.style.color = '';
                });

                this.style.backgroundColor = '#2b2b36';
                this.style.color = 'white';
                event.preventDefault();
            });
        });
    });

</script>
<script>
    // YouTube API 키
    var API_KEYS = ['AIzaSyDA9LFxcFVZSeLSemP3PS_p8hZ4f6hyHjM', 'AIzaSyC7Z6CURRfB6TPRSKaE66Q1VKb31kCJXUc', 'AIzaSyCq16BL6KkZ07QvpJ9XEMA8coki2_mPMdA']; // API 키 배열
    var currentKeyIndex = 0; // 현재 사용 중인 키의 인덱스

    function searchYouTube(searchTerm) {
        var encodedSearchTerm = encodeURIComponent(searchTerm);
        var request = new XMLHttpRequest();
        var apiKey = API_KEYS[currentKeyIndex];
        request.open('GET', 'https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=3&q=' + encodedSearchTerm + '&type=video&key=' + apiKey, true);

        request.onload = function () {
            if (this.status == 200) {
                var data = JSON.parse(this.responseText);
                displayVideos(data.items);
            } else if (this.status == 403) { // 한도 초과 오류 감지
                currentKeyIndex = (currentKeyIndex + 1) % API_KEYS.length; // 다음 키로 전환
                if (currentKeyIndex !== 0) { // 첫 번째 키로 돌아오지 않았는지 확인
                    searchYouTube(searchTerm); // 재시도
                } else {
                    console.error('모든 API 키의 한도가 초과됨');
                }
            } else {
                console.error('API 요청 실패:', this.responseText);
            }
        };

        request.onerror = function () {
            console.error('네트워크 오류 발생');
        };
        request.send();
    }


    // 비디오 목록을 표시하는 함수
    function displayVideos(videos) {
        var container = document.getElementById('portfolio-grid');
        container.innerHTML = ''; // 컨테이너 초기화
        videos.forEach(function (video) {
            var listItem = document.createElement('li');
            listItem.className = 'span4 mix web';
            listItem.innerHTML = '<div class="thumbnail">' +
                '<iframe width="370" height="200" src="https://www.youtube.com/embed/' + video.id.videoId + '" frameborder="0" allowfullscreen></iframe>' +
                '<h3>' + video.snippet.title + '</h3>' + // 영상 제목 추가
                '</div>';
            container.appendChild(listItem);
        });
    }

    // 페이지 로드 시 기본 검색어로 유튜브 검색 실행
    window.onload = function () {
        searchYouTube('서울시 문화행사');
    };
</script>
</body>
</html>